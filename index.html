Rafel RAT Artifacts
Base Concept
Malware can be found in many forms and Android applications are no exception. Malicious apps have started to become increasingly common due to the rising market share of Android as an operating system. According to statistics found on ExplodingTopics(iPhone vs Android User Stats (2024 Data)), Android was more than 70% of the global mobile OS market share from 2017 until the present. This was likely due to Android phones being cheaper on average than their iOS counterparts, which makes the platform a promising target for malicious actors.

In recent years, malicious Android apps with embedded remote access tools have become alarmingly more common. These applications are normally trojans as the malware is embedded within legitimate applications that normal users would install. As such, they are remote access trojans (RAT) which target the Android mobile operating system for extracting information to an external server.

In this case, the embedded RAT of focus is the Rafel RAT, which is an open source RAT project that can be found on GitHub at https://github.com/swagkarna/Rafel-Rat. The concern about the open sourced nature of this project is that it provides a potentially malicious framework for the public to freely use. This framework reduces the overhead required to create malicious Android applications which results in the issue of malware creation being more accessible to the general public.

To understand the Rafel RAT better, I set up a practical experiment to look for any artifacts left behind by the malware and determine if there is any persistence after deletion. Research about this Android RAT already exists, but most contain indicators of compromise (IOC) for phones that still have the malware installed. Although this is practical in many situations, there are often times when people will delete malware from their phone, potentially rendering the IOC unusable.
Too Long; Didn’t Read
The bottom line up front of this experiment is that yes, the Rafel RAT leaves behind artifacts after deletion, but they were unreliable with a few caveats. There was only one “good” artifact that I could determine from the deletion of the Rafel RAT which was the fb-schedule file located at /data/backup/fb-schedule. This file retained the package entry of the Rafel RAT application unlike all the other locations such as packages.xml which did not due to how Android deletes applications. However, the fb-schedule file was the only artifact that was human readable. There were other instances of potential artifacts that only had minor changes but some were not human readable, so it was hard to determine if it was truly an artifact caused by the Rafel RAT.
Introduction & Literature Review
	Research about the Rafel RAT has already been conducted extensively due to it being an open source project. However, there are only a handful of articles covering this topic which are all very in depth, but many are based on the article written by Check Point Software (Rafel RAT, Android Malware from Espionage to Ransomware Operations - Check Point Research). Due to the nature of Android applications, the IOCs available for the Rafel RAT are quite limited. They primarily consist of known malicious apk file hashes along with the known domain names of the command and control (C2) servers. Both can be quickly defeated with new app hashes and C2 domain names.
	
	The Rafel RAT spreads primarily through phishing attacks and social engineering because they are trojans that are not available in standard app stores. As such, bad actors have to convince users to install these unofficial applications which is complicated since Android has built in safeguards that prevent the installation of apps from unknown sources. Once installed, these applications will require elevated device admin privileges to enable full functionality of the embedded Rafel RAT. Based on the current research, the Rafel RAT has been used in both advanced persistent threat (APT) campaigns and other low profile attacks. Generally, it is used to target high value individuals such as political figures, but there have been instances of normal people becoming victims as well.

Fortunately, the discovered IOCs for the Rafel RAT can help prevent the spread of this malware. Using file hashes to prevent malware on Android systems primarily rely on the phone’s antivirus scanner blocking the installation with a positive file hash match. It can be also used to scan currently installed apks for potential matches as well. The domain name IOCs on the other hand rely on network forensics. It can be used to identify Rafel RAT activity by checking network logs of devices that may be sending to known C2 domains.
Materials Used
For this experiment, I dealt with live malware, so I had to be very careful by using a clean device that I could root along with a fake identity for Google Play services. I ended up buying a Google Pixel 7, model GVU6C, from eBay because it was not too much more expensive than other used phones due to a broken back camera glass. In addition, this specific model was factory unlocked from Google, so I could unlock the bootloader for rooting unlike other models of the same device from carriers like Verizon. For the sake of the lab, I also bought a prepaid phone service for my Google Pixel 7 from Mint Mobile so that it could have internet access without ever connecting to my home internet.

With the phone acquired, I then created a fake identity using the FauxId service which generated the name “Terrell Nicolas”. This was supplemented with an address at 1315 Walsh Ferry Greensboro, FL 32330. Using this identity, I created the “terrnico052301@gmail.com” Google account so that I could use Google Play services to install a GPS spoofing app and provide false data to the malware sample as seen later.

	Finally, the malware sample was acquired from the MalwareBazaar which is a service that hosts malware samples uploaded by users. I used the “d1f2ed3e379cde7375a001f967ce145a5bba23ca668685ac96907ba8a0d29320” SHA256 hash value to find the right sample which resulted in a MercadoPago apk file that I could load onto my lab device. I used the following tools to do my analysis:
Android Studio 2024.2.1
Autopsy 4.21.0
Magnet Acquire 2310.22469
WinMerge Version 2.16.44.0
Testing Procedure
	Before I even installed the malware, I spent a ton of time preparing my devices to ensure that nothing could be traced back to me. First, I covered all of my device’s cameras and microphones using electrical tape based on Google’s publicly available diagram for the Pixel 7 (Pixel phone hardware diagram - Pixel Phone Help). This blacked out the cameras, but did not fully block audio, so I stayed silent during this entire process. All images were also taken using my primary phone because screenshots on the lab device were risky since they could have contained EXIF data.

	Then, I analyzed the malware sample apk file using Android Studio to find out that the infected Mercado Pago app only ran on Android 13.
Because my Google Pixel 7 came loaded with Android 14, I used Google’s Android Flash Tool to quickly flash my device to the factory Android 13 image so that the malware sample could be installed.

	Once the phone was on the right Android version, I rooted the phone using Magisk by following a guide on XDAforums (How To Guide - Rooted my Pixel 7 | XDA Forums). Essentially, I patched the init_boot.img file that was obtained by downloading the factory image from Google (Factory Images for Nexus and Pixel Devices  |  Google Play services  |  Google for Developers) and flashing it into my device. In addition to rooting my phone, I also ended up spoofing my location using the “Fake GPS” app by ByteRevApps and setting it as my location spoofer in developer settings. For this experiment, I spoofed my device’s location to be in Greensboro, Florida as it was near the address of my fake identity.
	With all of the initial preparation complete, I used Magnet Acquire to obtain a logical image of my device before I installed the malware to use as a baseline for my analysis. Once the baseline “Before Malware Installation” imaging was complete, I proceeded to install the malware which was challenging. Due to Android’s built in protections, I had to disable both Google Play Protect and allow unknown source app installation before I could load the malware onto the device

Here, we can see that the malware is disguised as the Mercado Pago app which is an Argentinian banking app. The app asks for way too many permissions at the start which is a major red flag since it doesn’t make sense for a banking app to require direct file, phone, and sms permissions.
In addition to all of these absurd permission requests, it also requested for device admin privileges which is a huge red flag since it would give the app full control of the device.

Finally, I was able to load into the application which looks exactly like the non-infected version of the banking app.
However, one of the first things that I noticed outside of the previous two red flags was a notification banner titled “BlackMart” which told us to not close the app. The banner text was “Warning !! Dont Close the App” which was another red flag.

At this stage, I took another logical image of the device labelled as “After Malware Installation”. Once this was complete, I deleted the application so that I could take the final “After Malware Deletion” image to observe any artifacts leftover by the Rafel RAT infected application. An important thing to note here is that I first had to remove the malicious Mercado Pago’s device admin privilege.

Once all the imaging was complete, I factory reset my test device and flashed it with the newest Android 15 image. I ensured that the flashing process rewrote all partitions too, just in case the malware hid something outside of the filesystem.
Results & Analysis
Analysis of the images were first manually conducted using Autopsy where I went through all three images to check if obvious artifacts were left behind at first. Unfortunately, I could not really find anything, so I used WinMerge instead to compare all file and folder changes between the three images which yielded usable results.
Based on my analysis, the only easily identifiable artifact that was human readable was the fb-schedule file found at /data/backup/fb-schedule. This file retained the entry of the malicious application package after it was deleted from the system. 

Before installation of malware:

After installation of malware:
After deletion of malware:

As seen in the sequence above, there was a leftover entry of the “com.velociraptor.raptor” package after deletion of the RAT infected app. However, the caveats are that because I was dealing with a RAT, trojans can take on the same package name of normal applications which could be flagged as false positives. Fortunately, this was not true in my case as the malware sample I had of the Rafel RAT was for the Mercado Pago app. The correct package name for this Android app is 
“com.mercadopago.wallet” as seen in my app analysis using Android studio:

As for what the fb-schedule file is, I don't really have a clue and my best guess is that the file is used for determining what applications to back up since it contains many package names. Research on the fb-schedule file mainly comes back with facebook results which is clearly not the right result. In addition, there could be a possibility that this file may be specific to Google Pixel phones only as I used a Pixel 7 phone for the experiment.

	In addition to the fb-schedule artifact, there were other artifacts left in many parts of the file structure as seen in the picture below.
However, going through all of these files typically only showed minor changes where most were not human readable.
As such, it is hard to determine if these artifacts were really left behind by the Rafel RAT infected applications or just part of normal processes caused by the Android system.
Conclusion
This experiment produced semi-usable results as I was able to identify a single artifact left behind by one known sample of the Rafel RAT malware on a Google Pixel 7. However, there were some limitations that prevented me from verifying my results and accurately stating that my artifacts were universal across Android versions and phone manufacturers. Although I wanted to try out the other three known malware samples, I found out the hard way that they were developed for Android versions 12 and below. My Google Pixel 7 only had factory images available from Android 13 to 15, which prevented me from downgrading the stock operating system even further to test the other samples. I did look into sideloading unofficial Android versions for the Pixel, but I did not want to brick my device due a lack of experience and confidence. 

 Regardless of the limitations, I still believe that this experiment was important even though I only found one semi-usable instance of an artifact. This is due to my assumption that users are very likely to delete the malware instantly after installation due to all the red flags present during the setup process. My thought process is that normal users who get tricked into downloading these weird applications are going to be suspicious from the start. However, all of the additional privilege requests are going to spook users into deleting the malware, even if they have already granted them. This should put further emphasis on trying to locate evidence of malware having been on the device as it will help indicate if the user is the target of a campaign or not.
Future Work
There are many aspects of the experiment that I would like to improve in the future to fully verify my results and analysis. If I had unlimited time and resources, I would have liked to use different brands of devices with varying versions of the Android operating system to determine if my artifact was consistent or not. I would also experiment with other malware analysis tools such as MobSF, which failed during my experiment. This was due to a framework limitation of only supporting rooted devices up to Android 11 as seen in the screenshot from their documentation below.
Acknowledgement
	To finish off this blog post, I wanted to take the time to thank my professor, Jessica Hyde, of my DFOR 672 class who encouraged us to explore topics for our project. She guided us along the process and was extremely supportive the entire time, especially with the content she taught us in class. It was thanks to her that I got to play around with rooting Android phones again (and gave me an excuse to buy a Google Pixel phone). However, I now had a legitimate purpose for rooting phones as it was necessary for forensic purposes. I loved being able to verify my new knowledge which gave me practical experience in the lesser known topic of mobile digital forensics.
